<!doctype html>
<meta charset="UTF-8">
<html>
<head>
<title>Blackjack Practice</title>
</head>
<body onload="main()">

<table>
<tr>
 <td colspan="2" style="text-align:center; font-size:30px"> Dealer hand: </td>
</tr>

<tr>
 <td> <img id="dealer1"> </td>
 <td> <img id="dealer2"> </td>
</tr>

<tr>
 <td> &nbsp; </td>
</tr>

<tr>
 <td colspan="2" style="text-align:center; font-size:30px"> Your hand: </td>
</tr>

<tr>
 <td> <img id="player1"> </td>
 <td> <img id="player2"> </td>
</tr>
</table>

<p>&nbsp;</p>

<table>
<tr>
 <td colspan="2">
  <span id="msg" style="font-size:22px"></span>
 </td>
</tr>

<tr>
 <td> <button onclick="click_stand()" id="stand_btn">Stand</button> </td>
 <td> <button onclick="click_hit()" id="hit_btn">Hit</button> </td>
</tr>

<tr>
 <td> <button onclick="click_double()" id="double_btn">Double</button> </td>
 <td> <button onclick="click_split()" id="split_btn">Split</button> </td>
</tr>

<tr>
 <td> &nbsp; </td>
</tr>

<tr>
 <td colspan="2"> <button onclick="click_new_game()" id="new_game_btn">New game</button> </td>
 </td>
</tr>
</table>

</center>

<script>

// --------------------------------------------------------------------
// Globals

var config = {
};

var _game = null;

var _card_back = "card_back.jpg";

var _card_images = [
	"ace_of_hearts.png",
	"2_of_hearts.png",
	"3_of_hearts.png",
	"4_of_hearts.png",
	"5_of_hearts.png",
	"6_of_hearts.png",
	"7_of_hearts.png",
	"8_of_hearts.png",
	"9_of_hearts.png",
	"10_of_hearts.png",
	"jack_of_hearts2.png",
	"queen_of_hearts2.png",
	"king_of_hearts2.png",

	"ace_of_clubs.png",
	"2_of_clubs.png",
	"3_of_clubs.png",
	"4_of_clubs.png",
	"5_of_clubs.png",
	"6_of_clubs.png",
	"7_of_clubs.png",
	"8_of_clubs.png",
	"9_of_clubs.png",
	"10_of_clubs.png",
	"jack_of_clubs2.png",
	"queen_of_clubs2.png",
	"king_of_clubs2.png",

	"ace_of_diamonds.png",
	"2_of_diamonds.png",
	"3_of_diamonds.png",
	"4_of_diamonds.png",
	"5_of_diamonds.png",
	"6_of_diamonds.png",
	"7_of_diamonds.png",
	"8_of_diamonds.png",
	"9_of_diamonds.png",
	"10_of_diamonds.png",
	"jack_of_diamonds2.png",
	"queen_of_diamonds2.png",
	"king_of_diamonds2.png",

	"ace_of_spades.png",
	"2_of_spades.png",
	"3_of_spades.png",
	"4_of_spades.png",
	"5_of_spades.png",
	"6_of_spades.png",
	"7_of_spades.png",
	"8_of_spades.png",
	"9_of_spades.png",
	"10_of_spades.png",
	"jack_of_spades.png",
	"queen_of_spades2.png",
	"king_of_spades2.png",
];

// --------------------------------------------------------------------
class BJValue {
	constructor(value) {
		this.value = value;
		this.soft = (value == 1);
	}
	get_hard() {
		return this.value;
	}
	get_soft() {
		let value = this.value;
		if (this.soft) value += 10;
		return value;
	}
	is_soft() {
		return this.soft;
	}
	add(bjval) {
		this.value += val.value;
		if (bjval.soft) this.soft = true;
	}
}; // class BJValue

// --------------------------------------------------------------------
class Card {
	constructor(rank, suit) {
		this.rank = rank;
		this.suit = suit;
		this.image = "images/" + _card_images[(suit * 13) + rank];
	}
	get_bjvalue() {
		return new BJValue(this.rank);
	}
}; // class Card

// --------------------------------------------------------------------
class Deck {
	constructor() {
		this.cards = [];
		for (let rank = 0; rank < 13; ++rank) {
			for (let suit = 0; suit < 4; ++suit) {
				this.cards.push(new Card(rank, suit));
			}
		}
		this.shuffle();
	}
	shuffle() {
		for (let i = this.cards.length-1; i > 0; --i) {
			const j = randu(i);
			const t = this.cards[i];
			this.cards[i] = this.cards[j];
			this.cards[j] = t;
		}
	}
	deal() {
		const dealt = this.cards.splice(0, 1);
		return dealt[0];
	}
	add(card) {
		this.cards.push(card);
	}
}; // class Deck

// --------------------------------------------------------------------

class Game {
	constructor() {
		this.deck = new Deck();
		this.dealer_cards = [];
		this.player_cards = [];
		this.new_question();
	}
	new_question() {
		this.hand_over();
		this.deck.shuffle();
		const dealer_card1 = this.deck.deal();
		const dealer_card2 = this.deck.deal();
		const player_card1 = this.deck.deal();
		const player_card2 = this.deck.deal();

		el("dealer1").src = dealer_card1.image;
		el("dealer2").src = _card_back;
		el("player1").src = player_card1.image;
		el("player2").src = player_card2.image;
		this.enable_answer_btns(true);
		this.enable_new_game_btn(false);
		this.msg("Select a move...");
	}
	msg(text, text2) {
		el("msg").innerHTML = text;
	}
	hand_over() {
		this.enable_answer_btns(false);
		this.collect(this.dealer_cards);
		this.collect(this.player_cards);
		this.enable_new_game_btn(true);
	}
	enable_answer_btns(enable) {
		el("hit_btn").disabled = !enable;
		el("stand_btn").disabled = !enable;
		el("double_btn").disabled = !enable;
		el("split_btn").disabled = !enable;
	}
	enable_new_game_btn(enable) {
		el("new_game_btn").disabled = !enable;
	}
	collect(cards) {
		while (cards.length > 0) {
			this.deck.add(cards.pop());
		}
	}
	click_stand() {
		this.msg("Correct!");
		this.hand_over();
	}
	click_hit() {
		this.msg("Correct!");
		this.hand_over();
	}
	click_double() {
		this.msg("Correct!");
		this.hand_over();
	}
	click_split() {
		this.msg("Correct!");
		this.hand_over();
	}
	click_new_game() {
		this.new_question();
	}
}; // class Game

function click_stand() { if (_game != null) { _game.click_stand(); } }
function click_hit() { if (_game != null) { _game.click_hit(); } }
function click_double() { if (_game != null) { _game.click_double(); } }
function click_split() { if (_game != null) { _game.click_split(); } }
function click_new_game() { if (_game != null) { _game.click_new_game(); } }

// --------------------------------------------------------------------

function now() {
    return performance.now();
}

function munge_config() {
    for (const [key,value] of Object.entries(config)) {
        if (key.substr(0,6) == "color_")
            config[key] = new Color(config[key]);
    }
}

function el(name) {
    return document.getElementById(name);
}

function hex2(num) { return padnum(num, 2, 16); }

function zmod(x, m) {
    if (x >= 0) return x % m;
    let r = (-x) % m;
    if (r > 0) r = m - r;
    return r;
}

function randu(n) {
    return Math.floor(Math.random() * n);
}

function resize() {
	const hfrac = 1.452;
    const s = 20;
	const ww = window.innerWidth - s;
	const wh = window.innerHeight - s;
	const ch = wh * .20;
	const cw = ch / hfrac;
	const bw = cw;
	const bh = bw * .30;
	image_size("dealer1", cw, ch);
	image_size("dealer2", cw, ch);
	image_size("player1", cw, ch);
	image_size("player2", cw, ch);
	button_size("stand_btn", bw, bh);
	button_size("hit_btn", bw, bh);
	button_size("double_btn", bw, bh);
	button_size("split_btn", bw, bh);
	button_size("new_game_btn", bw, bh);
}

function image_size(name, w, h) {
	const image = el(name);
	image.width = w;
	image.height = h;
}

function button_size(name, w, h) {
	const image = el(name);
	image.style.width = w.toString() + "px";
	image.style.height = h.toString() + "px";
}

function main() {
    munge_config();
	resize();
	_game = new Game();
}

</script>
</body>
</html>
