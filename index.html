<!doctype html>
<meta charset="UTF-8">
<html>
<head>
<title>Blackjack Practice</title>

<style>
body {
}
.btn {
 font-weight: bold;
 border-radius: 16px;
}
</style>

</head>
<body style="background-color:#10e070" onload="main()">

<table style="width:100%">
 <tr>
  <td style="width:25%">
  <td id="title" style="width:50%; text-align:center"> Cindy's Blackjack Practice </td> 
  <td id="settings_btn" style="width:25%; text-align:right"> <button type="button" onclick="click_settings()"> Settings </button> </td>
 </tr>
</table>
<hr style="height:2px">

<center>
<table>
<tr>
 <td colspan="2" id="dealer_heading" style="text-align:center"> Dealer hand: </td>
</tr>

<tr>
 <td> <img id="dealer1" src="images/card_back.png"> </td>
 <td> <img id="dealer2" src="images/card_back.png"> </td>
</tr>

<tr>
 <td> &nbsp; </td>
</tr>

<tr>
 <td colspan="2" id="player_heading" style="text-align:center"> Your hand: </td>
</tr>

<tr>
 <td> <img id="player1" src="images/card_back.png"> </td>
 <td> <img id="player2" src="images/card_back.png"> </td>
</tr>
</table>
</center>

<p>
<center>
 <span id="msg" style="">&nbsp;</span>
</center>
</p> 

<center>
<table>
<tr>
 <td style="padding:2px"> <button type="button" class="btn" onclick="click_stand()" id="stand_btn" >Stand</button> </td>
 <td style="padding:2px"> <button type="button" class="btn" onclick="click_hit()" id="hit_btn" >Hit</button> </td>
</tr>

<tr>
 <td style="padding:2px"> <button type="button" class="btn" onclick="click_double()" id="double_btn" >Double</button> </td>
 <td style="padding:2px"> <button type="button" class="btn" onclick="click_split()" id="split_btn" >Split</button> </td>
</tr>

<tr id="sp1"> <td> &nbsp; </td> </tr>

<tr>
 <td colspan="2" style="padding:2px"> <button type="button" class="btn" onclick="click_new_hand()" id="new_hand_btn">New hand</button> </td>
 </td>
</tr>
</table>
</center>

<p>&nbsp;</p>
<hr style="height:2px">
<p style="text-align:right">
<span id="score" style="background-color:#f0f0f0"></span>
</p>

<div id="settings" style="position:fixed; display:none; width=100%; margin:10%; height=100%; border:3px solid black; top:0; left:0; right:0; bottom:0; background-color:#80a0f0; z-index:2">
 <center>
 <table style="margin:5%">
  <tr>
   <td colspan="3"; style="text-align:center; font-weight:bold; text-decoration:underline"> Settings </td>
  <tr>
   <td> Practice hard hands </td> <td>&nbsp;</td>
   <td> <input type="checkbox" id="settings_chk_hard"> </td>
  </tr>
  <tr>
   <td> Practice soft hands </td> <td>&nbsp;</td>
   <td> <input type="checkbox" id="settings_chk_soft"> </td>
  </tr>
  <tr>
   <td> Practice pairs </td> <td>&nbsp;</td>
   <td> <input type="checkbox" id="settings_chk_pair"> </td>
  </tr>
  <tr style="text-align:center">
   <td colspan="3">
    <button type="button" onclick="click_settings()">Done</button>
   </td>
  </tr>
 </table>
 </center>
</div>

<script>

// --------------------------------------------------------------------
// Globals

var config = {
    color_btn_disable_fg  : "#c0c0c0",
    color_btn_disable_bg  : "#e0e0e0",
    color_btn_enable_bg   : "#e0e030",
    color_correct         : "#c0ffc0",
    color_double          : "#0090f0",
    color_hit             : "#009030",
    color_msg             : "#f0f0f0",
    color_new_hand        : "#000000",
    color_split           : "#b06810",
    color_stand           : "#d00000",
    color_wrong           : "#ff0000",
};

var STAND  = 0;
var HIT    = 1;
var DOUBLE = 2;
var SPLIT  = 3;
var BJACK  = 4;

var PRAC_HARD = 0;
var PRAC_SOFT = 1;
var PRAC_PAIR = 2;
var NUM_PRACS = 3;

var _game = null;

var _card_back = "images/card_back.png";

var _card_images = [
    "ace_of_hearts.png",
    "2_of_hearts.png",
    "3_of_hearts.png",
    "4_of_hearts.png",
    "5_of_hearts.png",
    "6_of_hearts.png",
    "7_of_hearts.png",
    "8_of_hearts.png",
    "9_of_hearts.png",
    "10_of_hearts.png",
    "jack_of_hearts2.png",
    "queen_of_hearts2.png",
    "king_of_hearts2.png",

    "ace_of_clubs.png",
    "2_of_clubs.png",
    "3_of_clubs.png",
    "4_of_clubs.png",
    "5_of_clubs.png",
    "6_of_clubs.png",
    "7_of_clubs.png",
    "8_of_clubs.png",
    "9_of_clubs.png",
    "10_of_clubs.png",
    "jack_of_clubs2.png",
    "queen_of_clubs2.png",
    "king_of_clubs2.png",

    "ace_of_diamonds.png",
    "2_of_diamonds.png",
    "3_of_diamonds.png",
    "4_of_diamonds.png",
    "5_of_diamonds.png",
    "6_of_diamonds.png",
    "7_of_diamonds.png",
    "8_of_diamonds.png",
    "9_of_diamonds.png",
    "10_of_diamonds.png",
    "jack_of_diamonds2.png",
    "queen_of_diamonds2.png",
    "king_of_diamonds2.png",

    "ace_of_spades.png",
    "2_of_spades.png",
    "3_of_spades.png",
    "4_of_spades.png",
    "5_of_spades.png",
    "6_of_spades.png",
    "7_of_spades.png",
    "8_of_spades.png",
    "9_of_spades.png",
    "10_of_spades.png",
    "jack_of_spades2.png",
    "queen_of_spades2.png",
    "king_of_spades2.png",
];

var _move_tbl = [
    /* AA */ [ SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT  ], 
    /* A2 */ [ HIT,    HIT,    HIT,    HIT,    DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* A3 */ [ HIT,    HIT,    HIT,    HIT,    DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* A4 */ [ HIT,    HIT,    HIT,    DOUBLE, DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* A5 */ [ HIT,    HIT,    HIT,    DOUBLE, DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* A6 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* A7 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, STAND,  STAND,  HIT,    HIT    ], 
    /* A8 */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
    /* A9 */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
    /* AT */ [ BJACK,  BJACK,  BJACK,  BJACK,  BJACK,  BJACK,  BJACK,  BJACK,  BJACK,  BJACK  ], 
    /* 2A */ [ HIT,    HIT,    HIT,    HIT,    DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* 22 */ [ HIT,    SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  HIT,    HIT,    HIT    ], 
    /* 23 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 24 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 25 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 26 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 27 */ [ HIT,    HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ],
    /* 28 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT    ],
    /* 29 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE ], 
    /* 2T */ [ HIT,    HIT,    STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 3A */ [ HIT,    HIT,    HIT,    HIT,    DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* 32 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 33 */ [ HIT,    SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  HIT,    HIT,    HIT    ], 
    /* 34 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 35 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 36 */ [ HIT,    HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ],
    /* 37 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT    ], 
    /* 38 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE ], 
    /* 39 */ [ HIT,    HIT,    STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 3T */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 4A */ [ HIT,    HIT,    HIT,    DOUBLE, DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* 42 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 43 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 44 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 45 */ [ HIT,    HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* 46 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT    ], 
    /* 47 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE ], 
    /* 48 */ [ HIT,    HIT,    STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 49 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 4T */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 5A */ [ HIT,    HIT,    HIT,    DOUBLE, DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* 52 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 53 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 54 */ [ HIT,    HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* 55 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT    ], 
    /* 56 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE ], 
    /* 57 */ [ HIT,    HIT,    STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 58 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 59 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 5T */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 6A */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* 62 */ [ HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT,    HIT    ], 
    /* 63 */ [ HIT,    HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* 64 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT    ], 
    /* 65 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE ], 
    /* 66 */ [ HIT,    SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  HIT,    HIT,    HIT,    HIT    ], 
    /* 67 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 68 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 69 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 6T */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 7A */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, STAND,  STAND,  HIT,    HIT    ], 
    /* 72 */ [ HIT,    HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT,    HIT,    HIT,    HIT    ], 
    /* 73 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT    ], 
    /* 74 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE ], 
    /* 75 */ [ HIT,    HIT,    STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 76 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 77 */ [ HIT,    SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  HIT,    HIT,    HIT    ], 
    /* 78 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 79 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 7T */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
    /* 8A */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
    /* 82 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, HIT    ], 
    /* 83 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE ], 
    /* 84 */ [ HIT,    HIT,    STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 85 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 86 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 87 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 88 */ [ SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT  ], 
    /* 89 */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
    /* 8T */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
    /* 9A */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
    /* 92 */ [ HIT,    DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE ], 
    /* 93 */ [ HIT,    HIT,    STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 94 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 95 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 96 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 97 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* 98 */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
    /* 99 */ [ STAND,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  SPLIT,  STAND  ], 
    /* 9T */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
    /* TA */ [ BJACK,  BJACK,  BJACK,  BJACK,  BJACK,  BJACK,  BJACK,  BJACK,  BJACK,  BJACK  ], 
    /* T2 */ [ HIT,    HIT,    STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* T3 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* T4 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* T5 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* T6 */ [ HIT,    STAND,  STAND,  STAND,  STAND,  STAND,  HIT,    HIT,    HIT,    HIT    ], 
    /* T7 */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
    /* T8 */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
    /* T9 */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
    /* TT */ [ STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND,  STAND  ], 
];

// --------------------------------------------------------------------
class Card {
    constructor(rank, suit) {
        this.rank = rank;
        this.suit = suit;
        this.image = "images/" + _card_images[(suit * 13) + rank];
    }
    get_value() {
        return (this.rank < 10) ? this.rank+1 : 10;
    }
}; // class Card

// --------------------------------------------------------------------
class Deck {
    constructor() {
        this.cards = [];
        for (let rank = 0; rank < 13; ++rank) {
            for (let suit = 0; suit < 4; ++suit) {
                this.cards.push(new Card(rank, suit));
            }
        }
        this.shuffle();
    }
    shuffle() {
        for (let i = this.cards.length-1; i > 0; --i) {
            const j = randu(i);
            const t = this.cards[i];
            this.cards[i] = this.cards[j];
            this.cards[j] = t;
        }
    }
    deal() {
        const dealt = this.cards.splice(0, 1);
        return dealt[0];
    }
    add_card(card) {
        this.cards.push(card);
    }
}; // class Deck

// --------------------------------------------------------------------
class Game {
    constructor() {
        this.deck = new Deck();
        this.dealer_cards = [];
        this.player_cards = [];
        this.wrong_moves = 0;
        this.correct_moves = 0;
        this.move_tbl = _move_tbl;
        this.enable_new_hand_btn(true);
        this.prac = [ true, true, true ];
        this.new_question();
        this.set_score();
    }
    new_question() {
        el("dealer1").src = _card_back;
        el("dealer2").src = _card_back;
        el("player1").src = _card_back;
        el("player2").src = _card_back;
        for (;;) {
            this.hand_over();
            this.deck.shuffle();
            this.dealer_cards.push(this.deck.deal());
            this.player_cards.push(this.deck.deal());
            if (!this.prac[PRAC_SOFT] && this.player_cards[0].get_value() == 1)
                continue;
            this.player_cards.push(this.deal_final());
            this.correct_move = this.lookup_move();
            if (this.correct_move != BJACK) break;
        }
        el("dealer1").src = this.dealer_cards[0].image;
        el("dealer2").src = _card_back;
        el("player1").src = this.player_cards[0].image;
        el("player2").src = this.player_cards[1].image;
        this.enable_answer_btns(true);
        //this.enable_new_hand_btn(false);
        this.msg("&nbsp;<br>Select a move...");
    }
    lookup_move() {
        const p1 = this.player_cards[0].get_value()-1;
        const p2 = this.player_cards[1].get_value()-1;
        const px = p1*10 + p2;
        const dx = this.dealer_cards[0].get_value()-1; 
        return this.move_tbl[px][dx];
    }
    deal_final() {
        const pracs = (this.prac[PRAC_HARD] ? 1 : 0) + (this.prac[PRAC_SOFT] ? 1 : 0) + (this.prac[PRAC_PAIR] ? 1 : 0);
        for (;;) {
            let rp = randu(pracs);
            let prac_type;
            for (prac_type = 0; prac_type < 3; ++prac_type) {
                if (this.prac[prac_type]) {
                    if (rp-- == 0) break;
                }
            }
            const dcard = this.player_cards[0];
            const card = this.deck.deal();
            const soft = (card.get_value() == 1 || dcard.get_value() == 1);
            const pair = (card.get_value() == dcard.get_value());
            if (prac_type == PRAC_HARD && !soft && !pair)
                return card;
            if (prac_type == PRAC_SOFT && soft)
                return card;
            if (prac_type == PRAC_PAIR && pair && randu(2) == 0)
                return card;
            this.deck.add_card(card);
        }
    }
    msg(text) {
        el("msg").innerHTML = "&nbsp;<br>" + text;
    }
    hand_over() {
        this.enable_answer_btns(false);
        this.collect(this.dealer_cards);
        this.collect(this.player_cards);
        //this.enable_new_hand_btn(true);
        this.set_score();
    }
    can_double() {
        return true;
    }
    can_split() {
        return this.player_cards[0].get_value() == this.player_cards[1].get_value();
    }
    enable_answer_btns(enable) {
        this.enable_button("hit_btn", config.color_hit, enable);
        this.enable_button("stand_btn", config.color_stand, enable);
        this.enable_button("double_btn", config.color_double, enable && this.can_double());
        this.enable_button("split_btn", config.color_split, enable && this.can_split());
    }
    enable_new_hand_btn(enable) {
        this.enable_button("new_hand_btn", config.color_new_hand, enable);
    }
    enable_button(name, color, enable) {
        const btn = el(name);
        btn.disabled = !enable;
        btn.style.color = enable ? color : config.color_btn_disable_fg;
        btn.style.backgroundColor = enable ? config.color_btn_enable_bg : config.color_btn_disable_bg;
    }
    collect(cards) {
        while (cards.length > 0) {
            this.deck.add_card(cards.pop());
        }
    }
    click_stand() {
        this.click_move(STAND);
    }
    click_hit() {
        this.click_move(HIT);
    }
    click_double() {
        this.click_move(DOUBLE);
    }
    click_split() {
        this.click_move(SPLIT);
    }
    click_move(move) {
        const msg = this.move_msg(this.correct_move);
        if (move == this.correct_move) {
            this.correct_moves++;
            this.msg('<span style="background-color:'+config.color_correct+'">&nbsp;Correct!&nbsp;</span><br><span style="background-color:'+config.color_msg+';color:'+msg.color+'">&nbsp;'+msg.text+'</span><span style="background-color:'+config.color_msg+'"> is correct.&nbsp;</span>');
        } else {
            this.wrong_moves++;
            this.msg('<span style="background-color:'+config.color_wrong+';color:#ffffff">&nbsp;Wrong.&nbsp;</span><br><span style="background-color:'+config.color_msg+'">&nbsp;The correct move is </span><span style="background-color:'+config.color_msg+';color:'+msg.color+'">'+msg.text+'.&nbsp;</span>');
        }
        this.hand_over();
    }
    move_msg(move) {
        if (this.correct_move == HIT) {
            return { text: "HIT", color: config.color_hit };
        } else if (this.correct_move == STAND) {
            return { text: "STAND",  color: config.color_stand };
        } else if (this.correct_move == DOUBLE) {
            return { text: "DOUBLE", color: config.color_double };
        } else if (this.correct_move == SPLIT) {
            return { text: "SPLIT",  color: config.color_split };
        }
    }
    set_score() {
        const tot_moves = this.correct_moves + this.wrong_moves;
        const pct = (tot_moves == 0) ? 0 : Math.floor(100 * this.correct_moves / tot_moves);
        el("score").innerHTML = "&nbsp;"+pct.toString()+"% : "+this.correct_moves.toString()+" correct, "+this.wrong_moves.toString()+" wrong&nbsp;";
    }
    click_new_hand() {
        this.new_question();
    }
}; // class Game

function click_stand() { if (_game != null) { _game.click_stand(); } }
function click_hit() { if (_game != null) { _game.click_hit(); } }
function click_double() { if (_game != null) { _game.click_double(); } }
function click_split() { if (_game != null) { _game.click_split(); } }
function click_new_hand() { if (_game != null) { _game.click_new_hand(); } }

// --------------------------------------------------------------------
function click_settings() {
    const settings = el("settings");
    if (settings.style.display != "none") {
        _game.prac[PRAC_HARD] = el("settings_chk_hard").checked;
        _game.prac[PRAC_SOFT] = el("settings_chk_soft").checked;
        _game.prac[PRAC_PAIR] = el("settings_chk_pair").checked;
        if (!_game.prac[PRAC_HARD] && !_game.prac[PRAC_SOFT] && !_game.prac[PRAC_PAIR])
            _game.prac[PRAC_HARD] = true;
        settings.style.display = "none";
    } else {
        el("settings_chk_hard").checked = _game.prac[PRAC_HARD];
        el("settings_chk_soft").checked = _game.prac[PRAC_SOFT];
        el("settings_chk_pair").checked = _game.prac[PRAC_PAIR];
        settings.style.display = "block";
    }
}

// --------------------------------------------------------------------

function now() {
    return performance.now();
}

function el(name) {
    return document.getElementById(name);
}

function hex2(num) { return padnum(num, 2, 16); }

function zmod(x, m) {
    if (x >= 0) return x % m;
    let r = (-x) % m;
    if (r > 0) r = m - r;
    return r;
}

function randu(n) {
    return Math.floor(Math.random() * n);
}

function resize() {
    const hfrac = 1.452;
    const s = 20;
    const ww = window.innerWidth - s;
    const wh = window.innerHeight - s;
    const ch = wh * .16;
    const cw = ch / hfrac;
    const bw = cw * 1.5;
    const bh = bw * .30;
    const fh = wh * .03;
    image_size("dealer1", cw, ch);
    image_size("dealer2", cw, ch);
    image_size("player1", cw, ch);
    image_size("player2", cw, ch);
    button_size("stand_btn", bw, bh);
    button_size("hit_btn", bw, bh);
    button_size("double_btn", bw, bh);
    button_size("split_btn", bw, bh);
    button_size("new_hand_btn", bw*2, bh);
    font_size("dealer_heading", fh);
    font_size("player_heading", fh);
    font_size("title", fh*.8);
    font_size("msg", fh*.8);
    font_size("score", fh*.6);
    font_size("sp1", fh*2);
    font_size("settings", fh);
}

function font_size(name, fh) {
    const text = el(name);
    text.style.fontSize = Math.floor(fh) + "px";
}

function image_size(name, w, h) {
    const image = el(name);
    image.width = w;
    image.height = h;
}

function button_size(name, w, h) {
    const btn = el(name);
    btn.style.width = Math.floor(w).toString() + "px";
    btn.style.height = Math.floor(h).toString() + "px";
    btn.style.fontSize = Math.floor(h*.75).toString() + "px";
    btn.style.borderRadius = Math.floor(h*.3) + "px";
    btn.style.border = "2px solid black";
}

function main() {
    resize();
    window.addEventListener('resize', resize, false);
    _game = new Game();
}

</script>
</body>
</html>
